<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ูุนุฑุถ ุงูุตูุญุงุช</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/styles.css">
  <style>
    html, body { font-family: 'Cairo', system-ui, -apple-system, Segoe UI, Roboto, Arial, 'Noto Sans Arabic', sans-serif; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-indigo-50">
  <!-- Top Bar -->
  <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/70 bg-white/60 ring-1 ring-slate-200/60">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="size-9 rounded-lg bg-gradient-to-br from-indigo-500 to-fuchsia-500 grid place-items-center text-white shadow-sm">๐</div>
        <div>
          <p class="text-slate-900 font-extrabold tracking-tight">ูุนุฑุถ ุตูุญุงุช HTML</p>
          <p class="text-xs text-slate-500 hidden sm:block">ุฅูุดุงุก ูุชูุธูู ุงูุตูุญุงุช ุฏุงุฎู ูุฌูุฏุงุช ุจุณูููุฉ</p>
        </div>
      </div>
      <nav class="flex items-center gap-2">
        <a href="/create<%= folderId ? '?folder=' + folderId : '' %>" class="inline-flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-2 text-white text-sm font-semibold shadow hover:bg-indigo-700 transition">
          <span>โ</span> <span>ุตูุญุฉ ุฌุฏูุฏุฉ</span>
        </a>
        <button onclick="showCreateFolderModal()" class="inline-flex items-center gap-2 rounded-lg bg-slate-900 px-4 py-2 text-white text-sm font-semibold shadow hover:bg-black transition">
          <span>๐</span> <span>ูุฌูุฏ ุฌุฏูุฏ</span>
        </button>
        <% if (currentFolder) { %>
          <a href="<%= currentFolder.parentId ? '/?folder=' + currentFolder.parentId : '/' %>" class="inline-flex items-center gap-2 rounded-lg bg-white px-4 py-2 text-slate-700 text-sm font-semibold ring-1 ring-slate-200 hover:bg-slate-50 transition">
            โฌ๏ธ ููุฃุนูู
          </a>
        <% } %>
      </nav>
    </div>
  </header>

  <!-- Page -->
  <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
    <!-- Breadcrumb -->
    <% if (currentFolder) { %>
      <div class="mb-6 flex items-center text-sm text-slate-600">
        <a href="/" class="hover:text-slate-900 transition">๐ ุงูุฑุฆูุณูุฉ</a>
        <span class="mx-2 text-slate-400">/</span>
        <span class="font-semibold text-slate-900">๐ <%= currentFolder.name %></span>
      </div>
    <% } %>

    <!-- Folders -->
    <% if (folders && folders.length) { %>
      <section class="mb-10">
        <h2 class="mb-4 text-lg font-bold text-slate-900">ุงููุฌูุฏุงุช</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
          <% folders.forEach(folder => { %>
            <div class="group rounded-xl p-5 bg-gradient-to-br from-indigo-500 to-fuchsia-600 text-white shadow-sm ring-1 ring-white/10 hover:shadow-md transition">
              <div class="flex items-center justify-between mb-3">
                <h3 class="font-bold truncate" title="<%= folder.name %>">๐ <%= folder.name %></h3>
                <span class="opacity-80 text-xs">Folder</span>
              </div>
              <div class="flex gap-2">
                <a href="/?folder=<%= folder.id %>" class="inline-flex items-center justify-center flex-1 rounded-lg bg-white/15 hover:bg-white/25 text-white text-sm font-semibold py-2 transition">ูุชุญ</a>
                <button onclick="renameFolder('<%= folder.id %>', '<%= folder.name %>')" class="inline-flex items-center justify-center flex-1 rounded-lg bg-white/15 hover:bg-white/25 text-white text-sm font-semibold py-2 transition">ุชุณููุฉ</button>
                <button onclick="deleteFolder('<%= folder.id %>', '<%= folder.name %>')" class="inline-flex items-center justify-center rounded-lg bg-rose-500/90 hover:bg-rose-600 text-white text-sm font-semibold px-3 py-2 transition">ุญุฐู</button>
              </div>
            </div>
          <% }); %>
        </div>
      </section>
    <% } %>

    <!-- Pages -->
    <section>
      <% if (pages && pages.length) { %>
        <h2 class="mb-4 text-lg font-bold text-slate-900">ุงูุตูุญุงุช</h2>
      <% } %>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
        <% if ((!pages || pages.length === 0) && (!folders || folders.length === 0)) { %>
          <div class="col-span-full">
            <div class="rounded-2xl p-10 text-center bg-white/60 ring-1 ring-slate-200 shadow-sm">
              <p class="text-xl font-semibold text-slate-900">๐ ูุง ุชูุฌุฏ ุตูุญุงุช ุฃู ูุฌูุฏุงุช ุจุนุฏ</p>
              <p class="mt-1 text-slate-600">ุงุจุฏุฃ ุจุฅูุดุงุก ุฃูู ุตูุญุฉ ุฃู ูุฌูุฏ ุงูุขู</p>
            </div>
          </div>
        <% } else if (!pages || pages.length === 0) { %>
          <div class="col-span-full">
            <div class="rounded-2xl p-8 text-center bg-white/60 ring-1 ring-slate-200 shadow-sm">
              <p class="text-slate-700">๐ ูุง ุชูุฌุฏ ุตูุญุงุช ูู ูุฐุง ุงููุฌูุฏ</p>
            </div>
          </div>
        <% } else { %>
          <% pages.forEach(page => { %>
            <div class="group rounded-xl bg-white shadow-sm ring-1 ring-slate-200 hover:shadow-md transition overflow-hidden">
              <div class="bg-gradient-to-r from-indigo-600 to-fuchsia-600 p-5">
                <h3 class="text-white font-bold truncate" title="<%= page.name %>"><%= page.name %></h3>
                <p class="mt-1 text-white/90 text-xs">๐ <%= new Date(page.createdAt).toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' }) %></p>
              </div>
              <div class="p-5">
                <div class="flex flex-wrap gap-3">
                  <a href="/page/<%= page.id %>" target="_blank" class="inline-flex items-center justify-center flex-1 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold py-2.5 transition">๐๏ธ ุนุฑุถ</a>
                  <a href="/edit/<%= page.id %>" class="inline-flex items-center justify-center flex-1 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold py-2.5 transition">โ๏ธ ุชุนุฏูู</a>
                  <button onclick="deletePage('<%= page.id %>', '<%= page.name %>')" class="inline-flex items-center justify-center flex-1 rounded-lg bg-rose-500 hover:bg-rose-600 text-white text-sm font-semibold py-2.5 transition">๐๏ธ ุญุฐู</button>
                </div>
              </div>
            </div>
          <% }); %>
        <% } %>
      </div>
    </section>
  </main>

  <!-- Create Folder Modal -->
  <div id="createFolderModal" class="hidden fixed inset-0 bg-slate-900/40 backdrop-blur-sm grid place-items-center z-50">
    <div class="bg-white rounded-2xl p-6 w-full max-w-md shadow-xl ring-1 ring-slate-200">
      <h3 class="text-xl font-bold text-slate-900 mb-4">๐ ุฅูุดุงุก ูุฌูุฏ ุฌุฏูุฏ</h3>
      <input id="folderName" type="text" placeholder="ุงุณู ุงููุฌูุฏ" class="w-full rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 px-4 py-3 outline-none" />
      <div class="mt-5 flex gap-3">
        <button onclick="createFolder()" class="inline-flex items-center justify-center flex-1 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold py-2.5 transition">ุฅูุดุงุก</button>
        <button onclick="hideCreateFolderModal()" class="inline-flex items-center justify-center flex-1 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-800 text-sm font-semibold py-2.5 transition">ุฅูุบุงุก</button>
      </div>
    </div>
  </div>

  <script>
    const currentFolderId = '<%= folderId || "" %>';

    function showCreateFolderModal() {
      document.getElementById('createFolderModal').classList.remove('hidden');
      setTimeout(() => document.getElementById('folderName').focus(), 50);
    }
    function hideCreateFolderModal() {
      document.getElementById('createFolderModal').classList.add('hidden');
      document.getElementById('folderName').value = '';
    }

    async function createFolder() {
      const name = document.getElementById('folderName').value.trim();
      if (!name) return alert('ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงููุฌูุฏ');
      try {
        const res = await fetch('/api/folders', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, parentId: currentFolderId || null })
        });
        if (res.ok) { alert('ุชู ุงูุฅูุดุงุก'); location.reload(); }
        else { const d = await res.json(); alert('ุฎุทุฃ: ' + (d.error || 'ูุดู ุงูุฅูุดุงุก')); }
      } catch (e) { console.error(e); alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุงููุฌูุฏ'); }
    }

    async function deleteFolder(id, name) {
      if (!confirm(`ุญุฐู ุงููุฌูุฏ "${name}"ุ\nูู ููุญุฐู ุฅุฐุง ูุงู ูุญุชูู ุนูุงุตุฑ.`)) return;
      try {
        const res = await fetch(`/api/folders/${id}`, { method: 'DELETE' });
        if (res.ok) { alert('ุชู ุงูุญุฐู'); location.reload(); }
        else { const d = await res.json(); alert('ุฎุทุฃ: ' + (d.error || 'ูุดู ุงูุญุฐู')); }
      } catch (e) { console.error(e); alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู'); }
    }

    async function renameFolder(id, oldName) {
      const newName = prompt('ุฃุฏุฎู ุงูุงุณู ุงูุฌุฏูุฏ:', oldName);
      if (!newName || newName === oldName) return;
      try {
        const res = await fetch(`/api/folders/${id}`, {
          method: 'PUT', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name: newName })
        });
        if (res.ok) { alert('ุชู ุงูุชุบููุฑ'); location.reload(); }
        else { const d = await res.json(); alert('ุฎุทุฃ: ' + (d.error || 'ูุดู ุงูุชุบููุฑ')); }
      } catch (e) { console.error(e); alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุบููุฑ ุงูุงุณู'); }
    }

    async function deletePage(id, name) {
      if (!confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูุตูุญุฉ "${name}"ุ`)) return;
      try {
        const res = await fetch(`/api/pages/${id}`, { method: 'DELETE' });
        if (res.ok) { alert('ุชู ุญุฐู ุงูุตูุญุฉ'); location.reload(); }
        else { alert('ูุดู ุญุฐู ุงูุตูุญุฉ'); }
      } catch (e) { console.error(e); alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงูุตูุญุฉ'); }
    }

    document.getElementById('folderName').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') createFolder();
    });
  </script>
</body>
</html>
