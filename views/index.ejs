<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ูุนุฑุถ ุงูุตูุญุงุช - HTML Gallery</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/styles.css">
  <meta name="theme-color" content="#7c3aed">
</head>
<body class="section">
  <!-- Top Bar -->
  <header class="glass rounded-2xl px-4 sm:px-6 py-4 sm:py-5 max-w-7xl mx-auto mb-6 flex items-center justify-between gap-4">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-sky-400 to-violet-600 grid place-items-center text-white text-xl">โจ</div>
      <div>
        <h1 class="h-title text-2xl sm:text-3xl font-extrabold text-white">ูุนุฑุถ ุงูุตูุญุงุช</h1>
        <p class="text-white/80 text-xs sm:text-sm">ุฅูุดุงุก ูุชูุธูู ุตูุญุงุช HTML ุจุณูููุฉ</p>
      </div>
    </div>
    <nav class="flex items-center gap-2 sm:gap-3">
      <a href="/create<%= folderId ? '?folder=' + folderId : '' %>" class="btn inline-flex items-center gap-2 bg-white text-violet-700 font-semibold py-2.5 px-4 rounded-xl shadow">
        <span>โ</span>
        <span class="hidden sm:inline">ุตูุญุฉ ุฌุฏูุฏุฉ</span>
      </a>
      <button onclick="showCreateFolderModal()" class="btn inline-flex items-center gap-2 bg-yellow-300 text-violet-900 font-semibold py-2.5 px-4 rounded-xl shadow">
        <span>๐</span>
        <span class="hidden sm:inline">ูุฌูุฏ ุฌุฏูุฏ</span>
      </button>
      <% if (currentFolder) { %>
        <a href="<%= currentFolder.parentId ? '/?folder=' + currentFolder.parentId : '/' %>" class="btn inline-flex items-center gap-2 bg-gray-100 text-gray-800 font-semibold py-2.5 px-4 rounded-xl shadow">
          โฌ๏ธ ุฃุนูู
        </a>
      <% } %>
    </nav>
  </header>

  <!-- Breadcrumb -->
  <div class="max-w-7xl mx-auto mb-6">
    <% if (currentFolder) { %>
      <div class="glass rounded-2xl p-4 text-white/90">
        <span class="font-semibold">๐ ุงูุฑุฆูุณูุฉ</span>
        <span class="mx-2">/</span>
        <span class="font-semibold">๐ <%= currentFolder.name %></span>
      </div>
    <% } %>
  </div>

  <main class="max-w-7xl mx-auto grid gap-8">
    <!-- Folders -->
    <% if (folders.length > 0) { %>
      <section>
        <h2 class="text-white text-2xl sm:text-3xl font-bold mb-4">๐ ุงููุฌูุฏุงุช</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <% folders.forEach(folder => { %>
            <div class="card glass rounded-2xl p-5 text-violet-900">
              <div class="flex items-start justify-between mb-4">
                <h3 class="text-xl font-extrabold truncate" title="<%= folder.name %>">๐ <%= folder.name %></h3>
              </div>
              <div class="flex gap-2">
                <a href="/?folder=<%= folder.id %>" class="btn flex-1 bg-white/80 hover:bg-white text-violet-800 font-semibold py-2 px-3 rounded-lg text-sm text-center">ูุชุญ</a>
                <button onclick="renameFolder('<%= folder.id %>', '<%= folder.name %>')" class="btn flex-1 bg-white/60 hover:bg-white/80 text-violet-900 font-semibold py-2 px-3 rounded-lg text-sm">ุฅุนุงุฏุฉ ุชุณููุฉ</button>
                <button onclick="deleteFolder('<%= folder.id %>', '<%= folder.name %>')" class="btn bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-3 rounded-lg text-sm">ุญุฐู</button>
              </div>
            </div>
          <% }); %>
        </div>
      </section>
    <% } %>

    <!-- Pages -->
    <section>
      <% if (pages.length > 0) { %>
        <h2 class="text-white text-2xl sm:text-3xl font-bold mb-4">๐ ุงูุตูุญุงุช</h2>
      <% } %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <% if (pages.length === 0 && folders.length === 0) { %>
          <div class="col-span-full text-center">
            <div class="glass rounded-2xl p-10">
              <p class="text-2xl text-white mb-2">๐ ูุง ุชูุฌุฏ ุตูุญุงุช ุฃู ูุฌูุฏุงุช</p>
              <p class="text-white/80">ุงุจุฏุฃ ุจุฅูุดุงุก ุฃูู ุตูุญุฉ ุฃู ูุฌูุฏ ุงูุขู</p>
            </div>
          </div>
        <% } else if (pages.length === 0) { %>
          <div class="col-span-full text-center">
            <div class="glass rounded-2xl p-8">
              <p class="text-xl text-white">๐ ูุง ุชูุฌุฏ ุตูุญุงุช ูู ูุฐุง ุงููุฌูุฏ</p>
            </div>
          </div>
        <% } else { %>
          <% pages.forEach(page => { %>
            <article class="card bg-white rounded-2xl shadow-xl overflow-hidden border border-white/30">
              <div class="bg-gradient-to-r from-violet-600 to-fuchsia-600 p-6">
                <h3 class="text-2xl font-bold text-white truncate" title="<%= page.name %>"><%= page.name %></h3>
                <p class="text-white/90 text-sm mt-2">๐ <%= new Date(page.createdAt).toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' }) %></p>
              </div>
              <div class="p-5">
                <div class="flex flex-wrap gap-2">
                  <a href="/page/<%= page.id %>" target="_blank" class="btn flex-1 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2.5 px-4 rounded-lg text-center">๐๏ธ ุนุฑุถ</a>
                  <a href="/edit/<%= page.id %>" class="btn flex-1 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2.5 px-4 rounded-lg text-center">โ๏ธ ุชุนุฏูู</a>
                  <button onclick="deletePage('<%= page.id %>', '<%= page.name %>')" class="btn flex-1 bg-rose-500 hover:bg-rose-600 text-white font-semibold py-2.5 px-4 rounded-lg">๐๏ธ ุญุฐู</button>
                </div>
              </div>
            </article>
          <% }); %>
        <% } %>
      </div>
    </section>
  </main>

  <!-- Create Folder Modal -->
  <div id="createFolderModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm grid place-items-center z-50 p-4">
    <div class="bg-white rounded-2xl p-6 w-full max-w-md editor-shell">
      <h3 class="text-2xl font-bold text-violet-900 mb-4">๐ ุฅูุดุงุก ูุฌูุฏ ุฌุฏูุฏ</h3>
      <input type="text" id="folderName" placeholder="ุงุณู ุงููุฌูุฏ" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-violet-500 focus:outline-none mb-4">
      <div class="flex gap-3">
        <button onclick="createFolder()" class="flex-1 bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 rounded-lg">ุฅูุดุงุก</button>
        <button onclick="hideCreateFolderModal()" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-900 font-bold py-3 rounded-lg">ุฅูุบุงุก</button>
      </div>
    </div>
  </div>

  <script>
    const currentFolderId = '<%= folderId || "" %>';
    function showCreateFolderModal(){ document.getElementById('createFolderModal').classList.remove('hidden'); document.getElementById('folderName').focus(); }
    function hideCreateFolderModal(){ document.getElementById('createFolderModal').classList.add('hidden'); document.getElementById('folderName').value=''; }

    async function createFolder(){
      const name = document.getElementById('folderName').value.trim();
      if(!name){ alert('ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงููุฌูุฏ'); return; }
      const res = await fetch('/api/folders',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ name, parentId: currentFolderId || null }) });
      if(res.ok){ alert('ุชู ุฅูุดุงุก ุงููุฌูุฏ ุจูุฌุงุญ!'); location.reload(); }
      else{ const d=await res.json().catch(()=>({})); alert('ุฎุทุฃ: '+(d.error||'ูุดู ุฅูุดุงุก ุงููุฌูุฏ')); }
    }

    async function deleteFolder(id,name){
      if(!confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงููุฌูุฏ "${name}"ุ\n\nุชูุจูู: ูุง ูููู ุญุฐู ุงููุฌูุฏ ุฅุฐุง ูุงู ูุญุชูู ุนูู ุตูุญุงุช ุฃู ูุฌูุฏุงุช ูุฑุนูุฉ.`)) return;
      const res = await fetch(`/api/folders/${id}`,{ method:'DELETE' });
      if(res.ok){ alert('ุชู ุญุฐู ุงููุฌูุฏ ุจูุฌุงุญ!'); location.reload(); }
      else{ const d=await res.json().catch(()=>({})); alert('ุฎุทุฃ: '+(d.error||'ูุดู ุญุฐู ุงููุฌูุฏ')); }
    }

    async function renameFolder(id,oldName){
      const newName = prompt('ุฃุฏุฎู ุงูุงุณู ุงูุฌุฏูุฏ ูููุฌูุฏ:', oldName);
      if(!newName || newName===oldName) return;
      const res = await fetch(`/api/folders/${id}`,{ method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ name:newName }) });
      if(res.ok){ alert('ุชู ุชุบููุฑ ุงุณู ุงููุฌูุฏ ุจูุฌุงุญ!'); location.reload(); }
      else{ const d=await res.json().catch(()=>({})); alert('ุฎุทุฃ: '+(d.error||'ูุดู ุชุบููุฑ ุงูุงุณู')); }
    }

    async function deletePage(id,name){
      if(!confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูุตูุญุฉ "${name}"ุ`)) return;
      const res = await fetch(`/api/pages/${id}`,{ method:'DELETE' });
      if(res.ok){ alert('ุชู ุญุฐู ุงูุตูุญุฉ ุจูุฌุงุญ!'); location.reload(); }
      else{ alert('ูุดู ุญุฐู ุงูุตูุญุฉ'); }
    }

    document.getElementById('folderName')?.addEventListener('keypress', e => { if(e.key==='Enter') createFolder(); });
  </script>
</body>
</html>
