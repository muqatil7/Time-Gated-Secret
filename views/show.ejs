<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title %></title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/public/styles.css" />
  <script defer src="/public/app.js"></script>
</head>
<body class="min-h-screen antialiased">
  <div class="max-w-5xl mx-auto p-6">
    <header class="flex items-center justify-between gap-3" role="banner">
      <h1 class="text-3xl font-bold">Secret</h1>
      <div class="flex items-center gap-2">
        <a href="/list" class="inline-flex items-center rounded-md px-3 py-1.5 border border-slate-600 hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500">View list</a>
        <a href="/new" class="inline-flex items-center rounded-md px-3 py-1.5 border border-slate-600 hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500">Create another</a>
      </div>
    </header>

    <% if (typeof errors !== 'undefined' && errors && errors.length) { %>
      <div class="mt-4 rounded-md border border-red-200 bg-red-50 p-4 text-red-800">
        <ul class="list-disc list-inside space-y-1">
          <% errors.forEach(function(e){ %><li><%= e %></li><% }) %>
        </ul>
      </div>
    <% } %>

    <div class="mt-6" role="region" aria-live="polite" aria-atomic="true">
      <% if (isVisible) { %>
        <div class="rounded-lg border p-4" style="border-color:#14532d; background-color: rgba(34,197,94,0.08);">
          <div class="text-sm mb-2" style="color:#86efac;">Currently within a visible window</div>
          <div class="text-xl font-semibold break-words"><%= secret.secretText %></div>
        </div>
      <% } else { %>
        <div class="rounded-lg border p-4" style="border-color:#78350f; background-color: rgba(245,158,11,0.08);">
          <div class="text-sm" style="color:#facc15;">Secret is hidden at this time in <strong><%= secret.timezone %></strong>. Come back during a visible window.</div>
        </div>
      <% } %>
    </div>

    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="rounded-lg border card p-4 shadow-sm">
        <h2 class="text-lg font-semibold mb-2">Schedule</h2>
        <table class="w-full text-sm">
          <tbody>
            <% scheduleRows.forEach(function(row){ %>
              <tr class="border-b">
                <td class="py-2 font-medium"><%= row.dayName %></td>
                <td class="py-2">
                  <% if (!row.intervals.length) { %>
                    <span class="text-slate-400">Hidden all day</span>
                  <% } else if (row.intervals.length===1 && row.intervals[0].start==='00:00' && row.intervals[0].end==='24:00') { %>
                    <span>Visible all day</span>
                  <% } else { %>
                    <ul class="flex flex-wrap gap-2">
                      <% row.intervals.forEach(function(iv){ %>
                        <li class="rounded bg-slate-700/40 px-2 py-1"><%= iv.start %>â€“<%= iv.end %></li>
                      <% }) %>
                    </ul>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
        <div class="text-xs text-slate-400 mt-2">All times in <strong><%= secret.timezone %></strong></div>
      </div>

      <div class="rounded-lg border card p-4 shadow-sm md:col-span-2">
        <h2 class="text-lg font-semibold mb-2">Manage</h2>
        <% if (canModifySchedule) { %>
          <form method="POST" action="/s/<%= secret.id %>/update-schedule" class="space-y-4" aria-label="Update schedule form">
            <div>
              <label class="block text-sm font-medium mb-1" for="timezone">Time zone (IANA)</label>
              <input id="timezone" type="text" name="timezone" value="<%= secret.timezone %>" required class="w-full rounded-md border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </div>
            <div class="space-y-3">
              <% const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday']; %>
              <% for (let d = 0; d < 7; d++) { const ivs = secret.schedule.windowsPerDay[d] || []; const isAllDay = ivs.length===1 && ivs[0].start===0 && ivs[0].end===1440; %>
                <div class="border rounded-md p-3">
                  <div class="flex items-center justify-between mb-2">
                    <div class="font-medium"><%= days[d] %></div>
                    <label class="inline-flex items-center gap-2 text-sm">
                      <input type="checkbox" name="d<%= d %>_all_day" <%= isAllDay ? 'checked' : '' %> class="rounded border-slate-600" />
                      <span>All day visible</span>
                    </label>
                  </div>
                  <div class="time-grid mt-2">
                    <% for (let r = 1; r <= 3; r++) { const iv = ivs[r-1] && !isAllDay ? ivs[r-1] : null; %>
                      <div class="time-item">
                        <input type="time" name="d<%= d %>_r<%= r %>_start" value="<%= iv ? (String(Math.floor(iv.start/60)).padStart(2,'0')+':'+String(iv.start%60).padStart(2,'0')) : '' %>" class="time-input rounded-md border px-2 py-1" />
                        <span class="time-sep">to</span>
                        <input type="time" name="d<%= d %>_r<%= r %>_end" value="<%= iv ? (String(Math.floor(iv.end/60)).padStart(2,'0')+':'+String(iv.end%60).padStart(2,'0')) : '' %>" class="time-input rounded-md border px-2 py-1" />
                      </div>
                    <% } %>
                  </div>
                </div>
              <% } %>
            </div>
            <button type="submit" class="inline-flex items-center justify-center rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">Update schedule</button>
          </form>
        <% } else { %>
          <div class="text-sm text-slate-400">Schedule changes are only allowed during visible windows and before the secret ever enters a hidden period. Once a hidden period occurs, changes are permanently disabled.</div>
        <% } %>
      </div>
    </div>
  </div>
</body>
</html>


