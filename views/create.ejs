<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø©</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
  <style> html, body { font-family: 'Cairo', system-ui, -apple-system, Segoe UI, Roboto, Arial, 'Noto Sans Arabic', sans-serif; } .CodeMirror{height:520px;border-radius:12px} </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-indigo-50">
  <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/70 bg-white/60 ring-1 ring-slate-200/60">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <a href="<%= selectedFolderId ? '/?folder=' + selectedFolderId : '/' %>" class="inline-flex items-center gap-2 rounded-lg bg-white px-4 py-2 text-slate-700 text-sm font-semibold ring-1 ring-slate-200 hover:bg-slate-50 transition">â† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <div class="flex items-center gap-3">
        <div class="size-9 rounded-lg bg-gradient-to-br from-indigo-500 to-fuchsia-500 grid place-items-center text-white shadow-sm">âœ¨</div>
        <p class="text-slate-900 font-extrabold tracking-tight">Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø© HTML</p>
      </div>
      <span class="w-24"></span>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 py-8">
    <div class="bg-white/80 rounded-2xl shadow-sm ring-1 ring-slate-200 p-6">
      <form id="createForm" class="space-y-6">
        <div>
          <label for="name" class="block text-sm font-semibold text-slate-800 mb-2">ğŸ“ Ø§Ø³Ù… Ø§Ù„ØµÙØ­Ø©</label>
          <input id="name" name="name" type="text" required class="w-full rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 px-4 py-3 outline-none" placeholder="Ù…Ø«Ø§Ù„: ØµÙØ­ØªÙŠ Ø§Ù„Ø±Ø§Ø¦Ø¹Ø©">
        </div>

        <div>
          <label for="folderId" class="block text-sm font-semibold text-slate-800 mb-2">ğŸ“ Ø§Ù„Ù…Ø¬Ù„Ø¯</label>
          <select id="folderId" name="folderId" class="w-full rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 px-4 py-3 outline-none">
            <option value="">Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
            <% folders.forEach(folder => { %>
              <option value="<%= folder.id %>" <%= selectedFolderId === folder.id ? 'selected' : '' %>><%= folder.name %></option>
            <% }); %>
          </select>
          <p class="mt-1 text-xs text-slate-500">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù„Ø¯ Ù„Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø© Ø¯Ø§Ø®Ù„Ù‡</p>
        </div>

        <div>
          <label for="htmlContent" class="block text-sm font-semibold text-slate-800 mb-2">ğŸ’» Ù…Ø­ØªÙˆÙ‰ HTML</label>
          <textarea id="htmlContent" name="htmlContent"></textarea>
        </div>

        <div class="flex flex-col sm:flex-row gap-3">
          <button type="button" onclick="previewPage()" class="inline-flex items-center justify-center flex-1 rounded-lg bg-slate-900 hover:bg-black text-white text-sm font-semibold py-3 transition">ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
          <button type="submit" class="inline-flex items-center justify-center flex-1 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold py-3 transition">âœ”ï¸ Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø©</button>
        </div>
      </form>
    </div>
  </main>

  <script>
    const editor = CodeMirror.fromTextArea(document.getElementById('htmlContent'), {
      mode: 'htmlmixed', theme: 'monokai', lineNumbers: true, lineWrapping: true,
      autoCloseTags: true, autoCloseBrackets: true,
      value: `<!DOCTYPE html>\n<html lang="ar">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>ØµÙØ­ØªÙŠ</title>\n</head>\n<body>\n  <h1>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ!</h1>\n</body>\n</html>`
    });

    function previewPage() {
      const preview = window.open('', '_blank');
      preview.document.write(editor.getValue());
      preview.document.close();
    }

    document.getElementById('createForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const htmlContent = editor.getValue();
      const folderId = document.getElementById('folderId').value || null;
      if (!htmlContent.trim()) return alert('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø­ØªÙˆÙ‰ HTML!');
      try {
        const res = await fetch('/api/pages', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, htmlContent, folderId }) });
        if (res.ok) { alert('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­'); window.location.href = folderId ? `/?folder=${folderId}` : '/'; }
        else { const d = await res.json(); alert('âŒ Ø®Ø·Ø£: ' + (d.error || 'ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸')); }
      } catch (err) { console.error(err); alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸'); }
    });
  </script>
</body>
</html>
