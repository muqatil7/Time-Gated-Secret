<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title %></title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/public/styles.css" />
  <script defer src="/public/app.js"></script>
</head>
<body class="min-h-screen antialiased">
  <div class="max-w-5xl mx-auto p-6">
    <header role="banner" class="flex items-start justify-between gap-3">
      <div>
        <h1 class="text-3xl font-bold mb-2">Time-Gated Secret</h1>
        <p class="text-slate-400 mb-6">Create a plaintext secret that becomes visible only during your chosen windows. Outside those windows, it is completely inaccessible.</p>
      </div>
      <nav aria-label="Primary">
        <a href="/list" class="inline-flex items-center rounded-md px-3 py-1.5 border border-slate-600 hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500">View list</a>
      </nav>
    </header>

    <% if (errors && errors.length) { %>
      <div class="mb-6 rounded-md border border-red-200 bg-red-50 p-4 text-red-800">
        <ul class="list-disc list-inside space-y-1">
          <% errors.forEach(function(e){ %><li><%= e %></li><% }) %>
        </ul>
      </div>
    <% } %>

    <form method="POST" action="/secret" class="space-y-6" aria-describedby="form-help">
      <div>
        <label class="block text-sm font-medium mb-1" for="secretText">Secret text</label>
        <textarea id="secretText" name="secretText" rows="4" required class="w-full rounded-md border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your secret..."><%= (values && values.secretText) || '' %></textarea>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-1" for="timezone">Time zone (IANA)</label>
          <input id="timezone" type="text" name="timezone" value="<%= defaultTimezone %>" required class="w-full rounded-md border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Europe/London" aria-describedby="tz-help" />
          <p id="tz-help" class="text-xs text-slate-400 mt-1">Examples: UTC, Europe/London, Asia/Riyadh, America/New_York</p>
        </div>
        <div class="rounded-md border p-3">
          <p class="text-sm"><strong>Example schedule</strong>: Hidden all week except 13:00â€“17:00 visible. Friday is fully visible.</p>
        </div>
      </div>

      <div class="rounded-lg border p-4 card shadow-sm">
        <h2 class="text-lg font-semibold mb-3">Weekly visibility windows</h2>
        <p id="form-help" class="text-sm text-slate-400 mb-4">Add up to 3 intervals per day. Leave empty for fully hidden. Tick "All day" to make the secret visible for the whole day.</p>

        <div class="space-y-4">
          <% const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday']; %>
          <% for (let d = 0; d < 7; d++) { const ivs = (defaultSchedule.windowsPerDay[d] || []); %>
            <div class="border rounded-md p-4">
              <div class="flex items-center justify-between mb-2">
                <div class="font-medium"><%= days[d] %></div>
                <% const isAllDay = ivs.length===1 && ivs[0].start===0 && ivs[0].end===1440; %>
                <label class="inline-flex items-center gap-2 text-sm">
                  <input type="checkbox" name="d<%= d %>_all_day" <%= isAllDay ? 'checked' : '' %> class="rounded border-slate-600" />
                  <span>All day visible</span>
                </label>
              </div>
              <div class="time-grid mt-2">
                <% for (let r = 1; r <= 3; r++) { const iv = ivs[r-1] && !(ivs.length===1 && ivs[0].start===0 && ivs[0].end===1440) ? ivs[r-1] : null; %>
                  <div class="time-item">
                    <input type="time" name="d<%= d %>_r<%= r %>_start" value="<%= iv ? (String(Math.floor(iv.start/60)).padStart(2,'0')+':'+String(iv.start%60).padStart(2,'0')) : '' %>" class="time-input rounded-md border px-2 py-1" />
                    <span class="time-sep">to</span>
                    <input type="time" name="d<%= d %>_r<%= r %>_end" value="<%= iv ? (String(Math.floor(iv.end/60)).padStart(2,'0')+':'+String(iv.end%60).padStart(2,'0')) : '' %>" class="time-input rounded-md border px-2 py-1" />
                  </div>
                <% } %>
              </div>
            </div>
          <% } %>
        </div>
      </div>

      <div class="flex gap-3">
        <button type="submit" class="inline-flex items-center justify-center rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">Create secret</button>
        <a href="/" class="inline-flex items-center justify-center rounded-md border px-4 py-2 hover:bg-slate-800">Reset</a>
      </div>
    </form>
  </div>
</body>
</html>


