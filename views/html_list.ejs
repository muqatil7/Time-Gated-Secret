<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title %></title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/public/styles.css" />
</head>
<body class="min-h-screen antialiased">
  <nav class="sticky top-0 w-full py-3 px-6 bg-slate-800 border-b border-indigo-700 shadow flex items-center justify-between z-10">
    <div>
        <a href="/html/list" class="text-yellow-400 px-3 py-2 hover:bg-yellow-200 rounded transition text-lg font-bold">عرض الصفحات</a>
        <a href="/html" class="text-indigo-300 px-3 py-2 hover:bg-slate-700 rounded transition text-lg font-bold">إنشاء / تعديل صفحة</a>
    </div>
  </nav>
  <main class="max-w-4xl mx-auto my-7 p-6 card shadow-xl">
    <header role="banner" class="mb-6">
      <h1 class="text-3xl font-bold mb-2"><%= title %></h1>
      <p class="text-slate-400">هنا يمكنك إدارة جميع صفحات HTML التي قمت بحفظها.</p>
    </header>

    <!-- رسالة الحالة -->
    <div id="status-message" class="hidden mb-4 p-4 rounded-md text-center"></div>

    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-700">
        <thead class="bg-slate-800">
          <tr>
            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">اسم الصفحة</th>
            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">آخر تحديث</th>
            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-slate-300 uppercase tracking-wider">إجراءات</th>
          </tr>
        </thead>
        <tbody class="bg-slate-900 divide-y divide-slate-800">
          <% if (pages && pages.length > 0) { %>
            <% pages.forEach(page => { %>
              <tr id="page-<%= page.name %>">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white"><%= page.name %></td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-400"><%= new Date(page.updatedAt).toLocaleString('ar') %></td>
                <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                  <a href="/html/pages/<%= page.name %>" target="_blank" class="text-indigo-400 hover:text-indigo-300 ml-4">عرض</a>
                  <a href="/html?page=<%= page.name %>" class="text-yellow-400 hover:text-yellow-300 ml-4">تعديل</a>
                  <button onclick="deletePage('<%= page.name %>')" class="text-red-500 hover:text-red-400">حذف</button>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="3" class="px-6 py-4 whitespace-nowrap text-center text-sm text-slate-400">لا توجد صفحات محفوظة حالياً.</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </main>

  <script>
    function showMessage(msg, type = 'success') {
      const statusMessage = document.getElementById('status-message');
      statusMessage.textContent = msg;
      statusMessage.className = `mb-4 p-4 rounded-md text-center ${type === 'success' ? 'bg-green-100 text-green-800 border border-green-300' : 'bg-red-100 text-red-800 border border-red-300'}`;
      statusMessage.classList.remove('hidden');
      setTimeout(() => statusMessage.classList.add('hidden'), 5000);
    }

    async function deletePage(pageName) {
      if (!confirm(`هل أنت متأكد من حذف الصفحة "${pageName}" بشكل دائم؟`)) return;

      try {
        const response = await fetch(\`/html/pages/\${pageName}/delete\`, { method: 'POST' });
        const data = await response.json();

        if (data.success) {
          showMessage(data.message, 'success');
          const row = document.getElementById(\`page-\${pageName}\`);
          if (row) {
            row.remove();
          }
        } else {
          showMessage(data.message || 'فشل حذف الصفحة', 'error');
        }
      } catch (err) {
        showMessage('حدث خطأ أثناء الاتصال بالخادم', 'error');
      }
    }
  </script>
</body>
</html>
